"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e){var t=void 0;if("string"==typeof e?t=document.querySelector(e):e&&"NodeList"===e.childNodes.constructor.name&&(t=e),!t)return null;if(Cache.has(t))return Cache.get(t);var n=new Dollar(t);return Cache.set(t,n),n}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_zmEventKit=require("zm-event-kit"),Cache=new WeakMap,Dollar=function(){function e(t){_classCallCheck(this,e),this.el=t}return _createClass(e,[{key:"ready",value:function(e){"complete"!==document.readyState?document.addEventListener("DOMContentLoaded",e):e.call(document)}},{key:"on",value:function(e,t){var n=this;return this.el.addEventListener(e,t),new _zmEventKit.Disposable(function(){return n.el.removeEventListener(e,t)})}},{key:"once",value:function(e,t){var n=this,r=this.on(e,function(e){return r.dispose()||t.call(n,e)});return r}},{key:"find",value:function(e){return $(this.el.querySelector(e))}},{key:"findAll",value:function(e){return this.el.querySelectorAll(e).map($)}},{key:"hide",value:function(){return this.el.setAttribute("hidden",!0),this}},{key:"show",value:function(){return this.el.removeAttribute("hidden"),this}},{key:"toggleVisibility",value:function(){return this.el.hasAttribute("hidden")?this.show():this.hide(),this}},{key:"append",value:function(e){return this.el.appendChild(e.el||e),this}},{key:"appendTo",value:function(e){return(e.el||e).appendChild(this.el),this}},{key:"prepend",value:function(e){return this.el.insertBefore(e.el||e,this.el.firstChild),this}},{key:"prependTo",value:function(e){return e=e.el||e,e.insertBefore(this.el,e.firstChild),this}},{key:"insertAfter",value:function(e){return e=e||e.el,e.parentNode.insertBefore(this.el,e.nextSibling),this}},{key:"addClass",value:function(e){return this.el.classList.add(e),this}},{key:"removeClass",value:function(e){return this.el.classList.remove(e),this}},{key:"hasClass",value:function(e){return this.el.classList.contains(e)}},{key:"toggleClass",value:function(e){return this.el.classList.toggle(e),this}},{key:"setText",value:function(e){return this.el.textContent=e,this}},{key:"setHTML",value:function(e){return this.el.innerHTML=e,this}},{key:"isInViewPort",value:function(){var e=this.el.getBoundingClientRect();return e.top>=0&&e.bottom<=window.innerHeight}},{key:"offset",value:function(){return this.el.getBoundingClientRect()}},{key:"closest",value:function(e){return $(this.el.closest(e))}},{key:"trigger",value:function(e,t){var n=void 0;return t?n=new CustomEvent(e,{detail:t}):(n=document.createEvent("HTMLEvents"),n.initEvent(e,!0,!1)),this.el.dispatchEvent(n),n}},{key:"onScrollToBottom",value:function(e){var t=this,n=$(document).on("scroll",function(r){return document.body.scrollHeight<=document.body.scrollTop+window.innerHeight+1e3?(n.dispose(),e.call(t,r)):void 0});return n}},{key:"onScrollIntoView",value:function(e){var t=this;return $.setImmediate(function(){if(t.isInViewPort())return e.call(t);var n=null,r=document.on("scroll",function(){cancelAnimationFrame(n),n=requestAnimationFrame(function(){t.isInViewPort()&&(r.dispose(),e.call(t))})})}),this}},{key:"serializeAssoc",value:function(){var e={},t=/\r?\n/g,n=/%20/g;return this.findAll("[name]").forEach(function(r){r.name&&("checkbox"!==r.type&&"radio"!==r.type||r.checked)&&"string"==typeof r.value&&(e[r.name]=r.value.replace(t,"\n").replace(n,"+"))}),e}},{key:"serialize",value:function(){return $.ajax.serialize(this.serializeAssoc())}},{key:"hasChild",value:function(e){return e.parentNode===this.el}}]),e}();$.findAll=function(e){return document.querySelectorAll(e).map($)},$.byClass=function(e,t){return(t||document).getElementsByClassName(e).map($)},$.byTag=function(e,t){return(t||document).getElementsByTagName(e).map($)},$.byId=function(e){return $(document.getElementById(e))},$.ajax=function(e,t,n){return new Promise(function(r,o){var i=new XMLHttpRequest;i.open(t,e,!0),i.withCredentials=!0,i.addEventListener("load",function(){i.status>=200&&i.status<400?r(i.responseText):o({code:i.status,response:i.responseText})}),i.addEventListener("error",o),i.send(n)})},$.ajax.serialize=function(e){var t=[];for(var n in e)e[n]&&"object"==typeof e[n]&&(e[n]=window.ajax.serialize(e[n])),t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")},$.debounce=function(e,t){var n=null,r=function(r){var o=this;clearTimeout(n),n=setTimeout(function(){return e.call(o,r)},t)};return r.prototype=e.prototype,r},$.lock=function(e){var t=!1;return function(n){var r=this;return t?t:(t=!0,new Promise(function(t){t(e.call(r,n))}).then(function(e){return t=!1,e}))}},$.memoize=function(e){var t={},n=function(n){return t[n]?t[n]:t[n]=e.call(this,n)};return n.prototype=e.prototype,n},$.extend=function(){for(var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=1;t<=arguments.length;++t){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$.setImmediate=function(e){setTimeout(e,0)},$.reload=function(){var e=arguments.length<=0||void 0===arguments[0]?2e3:arguments[0];setTimeout(function(){return location.reload()},e)},$.getLocationParam=function(e){var t=new RegExp("[?&]"+e+"=[^&]+").exec(location.search);return t?decodeURIComponent(t.toString().replace(/^[^=]+./,"")):!1},$.fn=Dollar.prototype,Array.prototype.last=function(){return this[this.length-1]},Array.prototype.at=function(e){return e>=0?this[e]:this[this.length+e-1]},Array.prototype.insert=function(e,t){return this.splice(e,0,t),this},NodeList.prototype.forEach=HTMLCollection.prototype.forEach=HTMLFormControlsCollection.prototype.forEach=Array.prototype.forEach,NodeList.prototype.indexOf=HTMLCollection.prototype.indexOf=HTMLFormControlsCollection.prototype.indexOf=Array.prototype.indexOf,NodeList.prototype.last=HTMLCollection.prototype.last=HTMLFormControlsCollection.prototype.last=Array.prototype.last,NodeList.prototype.at=HTMLCollection.prototype.at=HTMLFormControlsCollection.prototype.at=Array.prototype.at,NodeList.prototype.map=HTMLCollection.prototype.map=HTMLFormControlsCollection.prototype.map=Array.prototype.map,["id","className","textContent","innerHTML","title","name","value","checked","selected"].forEach(function(e){Object.defineProperty(Dollar.prototype,e,{get:function(){return this.el[e]},set:function(t){return this.el[e]=t,this}})}),["classList","style","dataset","childNodes","children","firstElementChild","lastElementChild","firstChild","lastChild","parentNode"].forEach(function(e){Object.defineProperty(Dollar.prototype,e,{get:function(){return this.el[e]}})}),["addEventListener","removeEventListener","remove","matches","blur","focus","getAttribute","setAttribute","hasAttribute","removeAttribute","dispatchEvent","hasChildNodes"].forEach(function(e){Object.defineProperty(Dollar.prototype,e,{value:function(){var t=this.el[e].apply(this.el,arguments);return"undefined"==typeof t&&(t=this),t}})}),module.exports=$;